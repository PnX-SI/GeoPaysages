{% extends "layout.html" %}
{% block title %}Index{% endblock %}
{% block head %}
{{ super() }}
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.4/dist/leaflet.css" integrity="sha512-puBpdR0798OZvTTbP4A8Ix/l+A4dHDD0DGqYW6RQ+9jxkRFclaxxQb/SJAWZfWAkuyeQUytO7+7N4QKrDh+drA=="
  crossorigin="" />
<link rel="stylesheet" href="{{ url_for('static', filename='css/comparateur_style.css') }}">

<script src="https://unpkg.com/leaflet@1.3.4/dist/leaflet.js" integrity="sha512-nMMmRyTVoLYqjP9hrbed9S+FzjZHW5gY1TWCHA5ckwXZBadntCNs8kEqAWdrb9O7rxbCaA4lKTIWjDXZxflOcA=="
  crossorigin=""></script>
<script src="{{ url_for('static', filename='js/comparator.js') }}"></script>
{% endblock %}

{% block header_title %}
<h3 class="text-uppercase">Comparaison de photos - <span class="light">{{ site.name_site }}</span></h3>
{% endblock %}

{% block bodyClassNames %}page-comparateur{% endblock %}

{% block content %}
<div class="page-content container-fluid" id="js-app-comparator">
  <b-modal id="modal1" class="modal-fs modal-no-footer modal-img" no-fade lazy>
    <div class="img-wrapper" v-for="photo in zoomPhotos">
      <img :src="photo.lg" />
    </div>
  </b-modal>
  <div class="row">
    <!-- <div class="col-auto col-thumbs">
      <ul class="list-unstyled thumbs clearfix">
        {% for photo in site.photos %}
        <li v-on:click="onThumbClick({{ loop.index - 1 }})" v-bind:class="{'selected': isCompared({{ loop.index - 1 }})}">
          <img src="{{ photo.sm }}" />
          <span class="img-date">{{ photo.date }}</span>
        </li>
        {% endfor %}
      </ul>
    </div> -->
    <div class="col col-main">
      <div class="row compared">
        <div class="col-12 p-0 text-right">
          <b-btn v-on:click="onZoomClick()" :size="'sm'" :variant="'link'" class="btn-zoom" v-b-modal.modal1>
            <i class="material-icons align-middle">fullscreen</i>
          </b-btn>
        </div>
        <div class="d-flex align-items-center col-lg-6">
          <div class="img-wrapper">
            <span class="position-relative async" v-bind:class="{ 'async-resolved': comparedPhotos[0].comparedLoaded }">
              <div class="hidden-async-resolved progress">
                <div class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" aria-valuenow="100"
                  aria-valuemin="0" aria-valuemax="100"></div>
              </div>
              <img src="{{ photos[0].md }}" :src="comparedPhotos[0].md" @load="onComparedLoaded(0)" />
              <div class="w-100 img-date" v-html="comparedPhotos[0].date">{{ photos[0].date }}</div>
              <b-btn v-on:click="onZoomClick(0)" :size="'sm'" :variant="'link'" class="btn-zoom" v-b-modal.modal1>
                <i class="material-icons align-middle">fullscreen</i>
              </b-btn>
            </span>
          </div>
        </div>
        <div class="d-flex align-items-center col-lg-6">
          <div class="img-wrapper">
            <span class="position-relative async" v-bind:class="{ 'async-resolved': comparedPhotos[1].comparedLoaded }">
              <div class="hidden-async-resolved progress">
                <div class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" aria-valuenow="100"
                  aria-valuemin="0" aria-valuemax="100"></div>
              </div>
              <img src="{{ photos[1].md }}" :src="comparedPhotos[1].md" @load="onComparedLoaded(1)" />
              <div class="w-100 img-date" v-html="comparedPhotos[1].date">{{ photos[1].date }}</div>
              <b-btn v-on:click="onZoomClick(1)" :size="'sm'" :variant="'link'" class="btn-zoom" v-b-modal.modal1>
                <i class="material-icons align-middle">fullscreen</i>
              </b-btn>
            </span>
          </div>
        </div>
      </div>
      <div class="row mt-4">
        <ul class="list-unstyled thumbs">
          {% for photo in photos %}
          <li v-on:click="onThumbClick({{ loop.index - 1 }})" v-bind:class="{'selected': isCompared({{ loop.index - 1 }})}">
            <img src="{{ photo.sm }}" />
            <div class="img-date">{{ photo.date }}</div>
          </li>
          {% endfor %}
        </ul>
      </div>
      <div class="row mt-5">
        <div class="col-lg-4 mb-5">
          <div class="map-wrapper" ref="map"></div>
          <button class="btn btn-block btn-primary text-uppercase">
            Notice technique pour le photographe <i class="icon ion-md-download ml-2"></i>
          </button>
        </div>
        <div class="col-lg-8">
          <h5 class="text-uppercase">Description</h5>
          <div>
            {{ site.desc_site }}
          </div>
          <h5 class="text-uppercase mt-5">TÃ©moignage</h5>
          <div>
            {{ site.testim_site }}
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  document.onreadystatechange = () => {
    if (document.readyState == 'complete') {
      oppv.comparator({
        site: {{site | tojson}},
        photos: {{photos | tojson}}
      })
    }
  };

</script>

{% endblock %}
